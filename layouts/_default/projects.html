{{define "content"}}
	<header>
		<h1><a href="/">hjr265.me</a> / Projects</h1>
	</header>
	{{partial "nav.html" .}}

	{{$projects := .Resources.Match "*.md"}}

	{{range $i, $project := where $projects ".Params.featured" true}}
		<h2>Toph - Competitive Programming Platform</h2>
		
		<p><a href="{{.Params.website}}" target="_blank">{{.Params.website}}</a></p>

		{{.Content}}

		<p>Stack: {{delimit .Params.stack ", "}}</p>

	{{end}}

	<h2>Open Source Projects</h2>

	<ul class="projects">
		{{$sorted := slice}}
		{{range $i, $project := where $projects ".Params.openSource" true}}
			{{$link := ""}}
			{{$desc := ""}}
			{{$stars := 0}}
			{{with .Params.github}}
				{{$githubData := getJSON "https://api.github.com/repos/" .}}
				{{$link = . | printf "https://github.com/%s"}}
				{{with $githubData}}
					{{$desc = .description}}
					{{$stars = .stargazers_count}}
				{{end}}
			{{end}}
			{{$sorted = $sorted | append (dict "project" $project "link" $link "description" $desc "stars" $stars)}}
		{{end}}
		{{$sorted = sort $sorted "stars" "desc"}}
		{{range $i, $v := $sorted}}
			{{$project := index $v "project"}}
			<li>
				<div class="name"><a href="{{(index $v "link")}}" target="_blank">{{$project.Title}}</a></div>
				{{$starsvg := resources.GetMatch "star.svg" | fingerprint}}
				<div>{{or $project.Params.tagline (index $v "description")}} | <img src="{{$starsvg.RelPermalink}}" style="height: 1em; vertical-align: text-top;"> {{template "intmetric" (index $v "stars")}}</div>
			</li>
		{{end}}
	</ul>

	<div>[ More at <a href="https://github.com/hjr265" target="_blank">GitHub/hjr265</a>, <a href="https://github.com/FurqanSoftware" target="_blank">GitHub/FurqanSoftware</a> ]</div>
{{end}}

{{define "styles"}}
	{{$projectscss := resources.Get "projects.scss" | resources.ExecuteAsTemplate "" . | toCSS | minify | fingerprint}}
	<link rel="stylesheet" href="{{$projectscss.RelPermalink}}">
{{end}}

{{define "scripts"}}
	<script src="https://cdnjs.cloudflare.com/ajax/libs/gitgraph.js/1.15.2/gitgraph.min.js"></script>
	<script src="https://unpkg.com/ionicons@5.0.0/dist/ionicons.js"></script>
{{end}}

{{define "intmetric"}}
	{{if gt . 1000}}
		{{int (div . 1000) | printf "%dk"}}
	{{else}}
		{{.}}
	{{end}}
{{end}}
